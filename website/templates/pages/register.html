{% extends 'pages/base.html' %}
{% load crispy_forms_tags %}

{% block title %}Register · CRUD{% endblock %}

{% block content %}
  <div class="auth-layout row g-0">
    <div class="col-lg-6 auth-visual d-flex align-items-end">
      <div class="copy w-100">
        <span class="badge rounded-pill">Get started free</span>
        <h3 class="mt-3 mb-2">Create your account</h3>
        <p class="text-white-50 mb-0">Unlock the dashboard and start adding records.</p>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="p-4 p-md-5">
        <h3 class="mb-2">Register</h3>
        <p class="text-secondary mb-4">It only takes a minute</p>
        <form method="POST" autocomplete="off" novalidate>
          {% csrf_token %}
          {{ form|crispy }}
          <div class="mb-3">
            <div class="small text-secondary d-flex justify-content-between">
              <span>Password strength</span>
              <span id="pw-label" class="fw-medium">—</span>
            </div>
            <div class="progress" role="progressbar" aria-label="password strength" aria-valuemin="0" aria-valuemax="100">
              <div id="pw-bar" class="progress-bar" style="width: 0%"></div>
            </div>
          </div>
          <button type="submit" class="btn btn-primary w-100">Register</button>
        </form>
        <div class="text-center mt-3">
          <small>Already have an account? <a href="{% url 'login' %}">Login</a></small>
        </div>
        <div class="text-center mt-2">
          <small class="text-secondary">By signing up you agree to our terms and privacy policy.</small>
        </div>
      </div>
    </div>
  </div>
  <script>
    (function(){
      const pw = document.getElementById('id_password1');
      const bar = document.getElementById('pw-bar');
      const label = document.getElementById('pw-label');
      if(!pw || !bar || !label) return;

      function strength(s){
        let score = 0;
        if(!s) return 0;
        if(s.length >= 8) score += 25;
        if(/[A-Z]/.test(s)) score += 20;
        if(/[a-z]/.test(s)) score += 20;
        if(/\d/.test(s)) score += 15;
        if(/[^A-Za-z0-9]/.test(s)) score += 20;
        return Math.min(score, 100);
      }

      function labelFor(v){
        if(v < 30) return ['Weak','bg-danger'];
        if(v < 60) return ['Fair','bg-warning'];
        if(v < 85) return ['Good','bg-info'];
        return ['Strong','bg-success'];
      }

      function update(){
        const val = pw.value || '';
        const v = strength(val);
        const [text, klass] = labelFor(v);
        bar.style.width = v + '%';
        bar.className = 'progress-bar ' + klass;
        label.textContent = val ? text : '—';
      }
      pw.addEventListener('input', update);
      update();
    })();
  </script>
{% endblock content %}
