{% extends 'pages/base.html' %}
{% load ui_icons %}

{% block title %}Users · Admin{% endblock %}

{% block content %}
  <section class="rounded-3xl border border-white/10 bg-white/5 px-6 py-8 text-slate-200 shadow-[0_50px_110px_-70px_rgba(59,130,246,0.5)] backdrop-blur">
    <div class="flex flex-wrap items-start justify-between gap-4">
      <div class="space-y-3">
        <span class="inline-flex items-center gap-2 rounded-full border border-white/15 bg-white/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.24em] text-white/70">{% icon 'users-gear' classes='h-4 w-4' %} Team management</span>
        <h1 class="text-2xl font-semibold text-white">User access control</h1>
        <p class="max-w-xl text-sm text-slate-300">Promote teammates to staff, grant superuser access, and keep credentials updated.</p>
      </div>
      <a href="{% url 'admin_user_create' %}" class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-sky-500 to-indigo-500 px-5 py-2.5 text-sm font-semibold text-white shadow-[0_18px_36px_-24px_rgba(59,130,246,0.7)] transition hover:from-sky-400 hover:to-indigo-400">{% icon 'user-plus' classes='h-4 w-4' %} Add teammate</a>
    </div>
  </section>

  <section class="mt-8 overflow-hidden rounded-3xl border border-white/10 bg-white/5 shadow-[0_40px_90px_-60px_rgba(15,23,42,0.7)] backdrop-blur">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-white/10 text-sm text-slate-200">
        <thead class="bg-white/5 text-xs font-semibold uppercase tracking-[0.2em] text-white/60">
          <tr>
            <th scope="col" class="px-6 py-3 text-left">Username</th>
            <th scope="col" class="px-6 py-3 text-left">Email</th>
            <th scope="col" class="px-6 py-3 text-left">Joined</th>
            <th scope="col" class="px-6 py-3 text-left">Last login</th>
            <th scope="col" class="px-6 py-3 text-left">Admin</th>
            <th scope="col" class="px-6 py-3 text-left">Superuser</th>
            <th scope="col" class="px-6 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-white/5">
          {% for u in users %}
          <tr class="hover:bg-white/5">
            <td class="px-6 py-4 font-semibold text-white">{{ u.username }}</td>
            <td class="px-6 py-4 text-slate-300">{{ u.email|default:'—' }}</td>
            <td class="px-6 py-4 text-slate-300">{{ u.date_joined|date:'Y-m-d H:i' }}</td>
            <td class="px-6 py-4 text-slate-300">{{ u.last_login|default:'—' }}</td>
            <td class="px-6 py-4">
            {% if u.is_staff %}
                <span class="inline-flex items-center gap-2 rounded-full bg-emerald-500/20 px-3 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-emerald-200">{% icon 'circle-check' classes='h-4 w-4' %} Yes</span>
              {% else %}
                <span class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-white/60">No</span>
              {% endif %}
            </td>
            <td class="px-6 py-4">
            {% if u.is_superuser %}
                <span class="inline-flex items-center gap-2 rounded-full bg-rose-500/20 px-3 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-rose-200">{% icon 'shield' classes='h-4 w-4' %} Yes</span>
              {% else %}
                <span class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-semibold uppercase tracking-[0.18em] text-white/60">No</span>
              {% endif %}
            </td>
            <td class="px-6 py-4 text-right text-sm">
              {% if request.user.is_superuser and request.user != u %}
                <div class="flex flex-col items-end gap-2">
                  <form method="post" action="{% url 'toggle_staff' u.id %}" class="m-0 inline">
                    {% csrf_token %}
                    {% if u.is_staff %}
                      <button class="inline-flex items-center gap-2 rounded-xl border border-white/20 px-3 py-2 text-xs font-semibold text-white/80 transition hover:border-white/35 hover:bg-white/10" type="submit">{% icon 'user-slash' classes='h-4 w-4' %} Remove admin</button>
                    {% else %}
                      <button class="inline-flex items-center gap-2 rounded-xl border border-sky-300/40 px-3 py-2 text-xs font-semibold text-sky-200 transition hover:border-sky-200 hover:bg-sky-500/10" type="submit">{% icon 'user-tie' classes='h-4 w-4' %} Make admin</button>
                    {% endif %}
                  </form>
                  <form method="post" action="{% url 'toggle_superuser' u.id %}" class="m-0 inline">
                    {% csrf_token %}
                    {% if u.is_superuser %}
                      <button class="inline-flex items-center gap-2 rounded-xl border border-rose-300/40 px-3 py-2 text-xs font-semibold text-rose-200 transition hover:border-rose-200 hover:bg-rose-500/10" type="submit">{% icon 'shield' classes='h-4 w-4' %} Remove superuser</button>
                    {% else %}
                      <button class="inline-flex items-center gap-2 rounded-xl bg-rose-500/80 px-3 py-2 text-xs font-semibold text-white transition hover:bg-rose-500" type="submit">{% icon 'shield' classes='h-4 w-4' %} Make superuser</button>
                    {% endif %}
                  </form>
                </div>
              {% else %}
                <span class="text-xs uppercase tracking-[0.2em] text-white/40">—</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="px-6 py-12 text-center text-sm text-slate-300">
              <div class="mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-white/10 text-2xl text-white/70">
                {% icon 'circle-user' classes='h-6 w-6' %}
              </div>
              <p class="mt-4 text-sm text-slate-300">No users found. Invite someone by creating a new account.</p>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
{% endblock %}
